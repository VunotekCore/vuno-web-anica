---
import HeroSlider from "../components/HeroSlider.astro";
---

<!-- components/Hero.astro -->
<section
  class="w-full flex-shrink-0
    min-h-[calc(100vh-64px)]
    md:min-h-[calc(100vh-120px)]
    flex items-center justify-center
    py-4 md:py-0"
>
  <div class="w-full max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 items-center">
      <!-- LEFT: Slider -->
      <div class="w-full flex justify-center">
        <HeroSlider />
      </div>

      <!-- RIGHT: Formulario + WhatsApp + Redes -->
      <div class="flex flex-col items-center gap-6 md:gap-10">
        <!-- Contenido Derecho -->
        <div class="w-full max-w-sm relative">
          <div
            class="flex items-center bg-white border border-[#515151] rounded-xl shadow-sm px-5 py-3"
          >
            <input
              id="search-input"
              type="text"
              placeholder="Buscar servicios, productos, proyectos..."
              class="flex-1 outline-none text-sm font-lobster"
              autocomplete="off"
            />
            <svg
              width="20"
              height="20"
              fill="none"
              stroke="#515151"
              stroke-width="2"
            >
              <path d="M11 19l-4-4m0 0a6 6 0 1110.472-3.472A6 6 0 017 15z"
              ></path>
            </svg>
          </div>

          <!-- Search Results Dropdown -->
          <div
            id="search-results"
            class="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-100 hidden z-50 overflow-hidden max-h-96 overflow-y-auto"
          >
            <!-- Results will be injected here -->
          </div>
        </div>

        <script>
          let searchIndex = [];
          let isLoading = false;

          const searchInput = document.getElementById("search-input");
          const searchResults = document.getElementById("search-results");

          // Load index once on interaction
          const loadIndex = async () => {
            if (searchIndex.length > 0 || isLoading) return;
            isLoading = true;
            try {
              const res = await fetch("/api/search.json");
              searchIndex = await res.json();
            } catch (e) {
              console.error("Error loading search index", e);
            } finally {
              isLoading = false;
            }
          };

          searchInput?.addEventListener("focus", loadIndex);

          searchInput?.addEventListener("input", (e) => {
            const query = (e.target as HTMLInputElement).value.toLowerCase();

            if (query.length < 2) {
              searchResults?.classList.add("hidden");
              return;
            }

            const results = searchIndex.filter((item) => {
              const title = item.title?.toLowerCase() || "";
              const type = item.type?.toLowerCase() || "";
              return title.includes(query) || type.includes(query);
            });

            if (results.length > 0) {
              const html = results
                .map(
                  (item) => `
        <a href="${item.url}" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-50 last:border-0 transition-colors">
          <div class="flex justify-between items-center mb-1">
            <span class="font-bold text-neutral text-sm">${item.title}</span>
            <span class="text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary font-medium">${item.type}</span>
          </div>
          <p class="text-xs text-neutral-light line-clamp-1">${item.excerpt || ""}</p>
        </a>
      `,
                )
                .join("");

              if (searchResults) {
                searchResults.innerHTML = html;
                searchResults.classList.remove("hidden");
              }
            } else {
              if (searchResults) {
                searchResults.innerHTML = `
                <div class="px-4 py-3 text-sm text-neutral-light text-center">
                    No se encontraron resultados para "${query}"
                </div>
            `;
                searchResults.classList.remove("hidden");
              }
            }
          });

          // Close when clicking outside
          document.addEventListener("click", (e) => {
            if (
              !searchInput?.contains(e.target as Node) &&
              !searchResults?.contains(e.target as Node)
            ) {
              searchResults?.classList.add("hidden");
            }
          });
        </script>

        <!-- Floating Contact Buttons -->
        <div class="fixed bottom-6 right-6 z-50 flex flex-col gap-4">
          <!-- Email/Contact Button (arriba) -->
          <a
            href="/contacto"
            class="group flex items-center justify-center hover:scale-110 hover:shadow-xl transition-all duration-500 border border-white/10 animate-float bg-white rounded-full p-2 shadow-lg"
            style="animation-delay: 0.2s"
            aria-label="Escríbenos por correo o agenda una cita"
          >
            <!-- Icono de correo en naranja corporativo -->
            <svg
              width="36"
              height="36"
              class="w-7 h-7 md:w-16 md:h-16 drop-shadow-lg"
              fill="#F15A24"
              viewBox="0 0 24 24"
            >
              <path
                d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"
              ></path>
            </svg>

            <!-- Pulse indicator -->
            <!-- <span class="absolute -top-0.1 -right-0.1">
              <span class="relative flex h-6 w-6">
                <span
                  class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary/50"
                ></span>
                <span
                  class="relative inline-flex rounded-full h-2 w-2 bg-primary"
                ></span>
              </span>
            </span> -->

            <!-- Tooltip -->
            <span
              class="absolute right-full mr-4 top-1/2 -translate-y-1/2
                   px-4 py-2 bg-primary text-white text-sm rounded-2xl
                   opacity-0 group-hover:opacity-100 pointer-events-none
                   transition-opacity duration-300 whitespace-nowrap
                   before:absolute before:left-full before:top-1/2 before:-translate-y-1/2
                   before:border-8 before:border-transparent before:border-l-primary"
            >
              Escríbenos por correo o agenda una cita
            </span>
          </a>

          <!-- WhatsApp Button (abajo) -->
          <a
            href="https://wa.me/50585555595?text=¡Hola!%20Vengo%20de%20tu%20web%20y%20me%20gustaría%20hablar%20contigo%20%F0%9F%98%8A"
            target="_blank"
            rel="noopener"
            class="group flex items-center justify-center hover:scale-110 hover:shadow-xl transition-all duration-500 border border-white/10 animate-float bg-white rounded-full p-2 shadow-lg"
            aria-label="Chatea por WhatsApp"
          >
            <!-- Icono WhatsApp en verde corporativo -->
            <svg
              width="36"
              height="36"
              class="w-7 h-7 md:w-16 md:h-16 drop-shadow-lg"
              fill="#3EA530"
            >
              <use xlink:href="/assets/sprite.svg#wp"></use>
            </svg>

            <!-- Pulse indicator -->
            <span class="absolute -top-0.1 -right-0.5">
              <span class="relative flex h-6 w-6">
                <span
                  class="animate-ping absolute inline-flex h-full w-full rounded-full bg-secondary/50"
                ></span>
                <span
                  class="relative inline-flex rounded-full h-2 w-2 bg-secondary"
                ></span>
              </span>
            </span>

            <!-- Tooltip -->
            <span
              class="absolute right-full mr-4 top-1/2 -translate-y-1/2
                   px-4 py-2 bg-secondary text-white text-sm rounded-2xl
                   opacity-0 group-hover:opacity-100 pointer-events-none
                   transition-opacity duration-300 whitespace-nowrap
                   before:absolute before:left-full before:top-1/2 before:-translate-y-1/2
                   before:border-8 before:border-transparent before:border-l-secondary"
            >
              ¡Hablemos por WhatsApp!
            </span>
          </a>
        </div>

        <!-- Social icons con animaciones -->
        <div
          class="flex items-center gap-8 md:gap-12 pt-2 md:pt-4 mt-2 md:mt-3 font-montserrat animate-social-fade"
        >
          <!-- Instagram -->
          <a
            href="#"
            class="transition hover:text-heading-1 hover:scale-110 transform hover:rotate-6 duration-300 animate-icon-pop"
            style="animation-delay: 100ms"
            target="_blank"
            title="Estamos en instagram"
          >
            <svg
              width="36"
              height="36"
              class="md:w-[42px] md:h-[42px]"
              fill="#515151"
            >
              <use xlink:href="/assets/sprite.svg#instagram"></use>
            </svg>
            <span class="sr-only">social link</span>
          </a>

          <!-- Facebook -->
          <a
            href="#"
            class="transition hover:text-heading-1 hover:scale-110 transform hover:rotate-6 duration-300 animate-icon-pop"
            style="animation-delay: 200ms"
            target="_blank"
            title="Estamos en facebook"
          >
            <svg
              width="36"
              height="36"
              class="md:w-[42px] md:h-[42px]"
              fill="#515151"
            >
              <use xlink:href="/assets/sprite.svg#fb"></use>
            </svg>
            <span class="sr-only">social link</span>
          </a>

          <!-- Ubicación -->
          <a
            href="#"
            class="transition hover:text-heading-1 hover:scale-110 transform hover:rotate-6 duration-300 animate-icon-pop"
            style="animation-delay: 300ms"
            target="_blank"
            title="Nuestra ubicación"
          >
            <svg
              width="36"
              height="36"
              class="md:w-[42px] md:h-[42px]"
              fill="#515151"
            >
              <use xlink:href="/assets/sprite.svg#location"></use>
            </svg>
            <span class="sr-only">social link</span>
          </a>
        </div>
        <!-- Badge de Experiencia -->
        <div class="flex items-center gap-3 pt-4 animate-badge-slide">
          <div
            class="flex items-center gap-3 px-6 py-4 bg-gradient-to-r from-[#515151] to-gray-700 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105"
          >
            <svg
              width="32"
              height="32"
              fill="none"
              stroke="#ffffff"
              stroke-width="2"
              viewBox="0 0 24 24"
              class="animate-pulse"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            <div class="text-white">
              <p class="text-sm font-medium opacity-90">
                Experiencia Comprobada
              </p>
              <p class="text-2xl font-bold font-lobster">6+ Años</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Animación fade-in para iconos sociales */
  @keyframes social-fade {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-social-fade {
    animation: social-fade 0.8s ease-out;
  }

  /* Animación pop para cada icono social */
  @keyframes icon-pop {
    from {
      opacity: 0;
      transform: scale(0.8);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .animate-icon-pop {
    animation: icon-pop 0.5s ease-out forwards;
    opacity: 0;
  }

  /* Animación slide para el badge de experiencia */
  @keyframes badge-slide {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .animate-badge-slide {
    animation: badge-slide 0.8s ease-out 0.4s forwards;
    opacity: 0;
  }
</style>
